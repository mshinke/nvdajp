os: Visual Studio 2019
version: "{branch}-{build}"
build_cloud: shuaruta-win-230805

skip_tags: true
branches:
  only:
    - /alphajp.*/
    - /betajp.*/
    - /releasejp.*/

clone_depth: 1

environment:
  PY_PYTHON: 3.7-32

init:
  - set PATH=%PATH%;C:\MinGW;C:\MinGW\bin;C:\MinGW\msys\1.0

install:
  - set RELEASE=1
  - set VERSION=2023.2jp
  - set UPDATEVERSIONTYPE=nvdajp
  - for /F "usebackq" %%t in (`jptools\nowdate.cmd`) do set NOWDATE=%%t
  - ps: |
    if ($env:APPVEYOR_REPO_BRANCH.StartsWith("alphajp")) {
        $env:VERSION = "jpalpha_" + $env:NOWDATE
        $env:UPDATEVERSIONTYPE += "alpha"
    } elseif ($env:APPVEYOR_REPO_BRANCH.StartsWith("betajp")) {
        $env:VERSION += "-beta-" + $env:NOWDATE
        $env:UPDATEVERSIONTYPE += "beta"
    } elseif ($env:APPVEYOR_REPO_BRANCH.StartsWith("releasejp")) {
        $env:VERSION += "-" + $env:NOWDATE
    }
    if ($env:APPVEYOR_PROJECT_SLUG -ne "nvdajp") {
        $env:VERSION += "-noncert"
    }
  - set PUBLISHER=nvdajp
  - echo %PUBLISHER% %UPDATEVERSIONTYPE% %VERSION%
  - git submodule update --init --recursive

build_script:
  - ps: |
    $sconsArgs = "version_build=$env:APPVEYOR_BUILD_NUMBER"
    & ".\jptools\nonCertAllBuild.cmd" $sconsArgs
    if ($LastExitCode -eq 0) {
        Write-Output "completed successfully."
    } else {
        Write-Output "An error occurred during the execution."
    }

test: off
